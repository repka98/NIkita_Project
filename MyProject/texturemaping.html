<!DOCTYPE html>
<html>
<head>
	<title>texturemaping</title>
	<meta http-equiv="content-type"  content="text/html; charset=ISO-8859-1">

	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
	<style type-"text/css">
		body {
			background-color: #0000000;
			overflow: hidden;
			font-family: monospace;
			color: white;
		}
	</style>

	<script src="../resources/three.js"></script>
	<script src="../resources/Detector.js"></script>
	<script src="../resources/CanvasRenderer.js"></script>
	<script src="../resources/Projector.js"></script>
</head>
<body>

	<div id="overlaytext" stylr="position: absolute; top: 10px; left: 10px">
		'F': Loop through thr three texture filters (only for WegbGL renderer)<br/>
		'L': Toggle light (only for WebGL renderer)<br/>
		Cursor Left / Right: Control y rotation speed<br/>
		Cursor up/ down: Move along z axis<br/>
		Renderer:
	</div>

	<div id="WebGLCanvas">

	<script>

		var scene;
		var camera;
		var xRotation = 0.0;
		var yRotation = 0.0;

		var cubeMesh;

		var xSpeed = 0.0;
		var ySpeed = 0.0;

		var zTranslation = 0.0;

		var createTexture;
		var textureFilter = 0;

		var lightIsOn = true;


		initializeScene();
		animatedScene();


		function initializeScene() {
			webGLAvalibale = false;
			if (Detector.webgl) {
				renderer = new THREE.WebGLRenderer({antialias:true});
				webGLAvaliable = true;
				document.getElementById("overlaytext").innerHTML += "WebGL Renderer";
			}else {
				renderer = new THREE.CanvasRenderer();
				document.getElementById("overlaytext").innerHTML += "Canvas Renderer";
			}

			renderer.setClearColor(0x000000, 1);

			canvasWidth = window.innerWidth - 10;
			canvasHeight = window.innerHeight - 20;

			renderer.setSize(canvasWidth, canvasHeight);

			document.getElementById("WebGLCanvas").appendChild(renderer.domElement);

			scene = new THREE.Scene();

			camera = new THREE.PerspectiveCamera(45, canvasWidth / canvasHeight, 1, 100);
			camera.position.set(0, 0, 6);
			camera.lookAt(scene.position);
			scene.add(camera);

			var boxGeometry = new THREE.BoxGeometry(2.0, 2.0, 2.0);
			createTexture = new THREE.TextureLoader("../resources/images/nehe.jpg");
			var boxMaterial = new THREE.MeshBasicMaterial({
				map:createTexture,
				side:THREE.DoubleSide
			});

			if (!webGLAvaliable) {
				boxMaterial = new THREE.MeshBasicMaterial({
					map: createTexture,
					side: THREE.DoubleSide
				});
			}


			boxMesh = new THREE.Mesh(boxGeometry, boxMaterial);
			boxMesh.position.set(camera.position.x, camera.position.y, camera.position.z);
			scene.add(boxMesh);

			var ambientLight = new THREE.AmbientLight(0x101010, 1.0);
			scene.add(ambientLight);

			directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
			directionalLight.position.set(0.0, 0.0, 1.0);
			scene.add(directionalLight);

			document.addEventListener("keydown", onDocumentKeyDown, false); 

		}

		function onDocumentKeyDown(event) {
			var keyCode = event.which;

			if (keyCode == 70) {
				switch(textureFilter) {
					case 0:
						createTexture.minFilter = THREE.NearestFilter;
						createTexture.magFilter = THREE.NearestFilter;
						textureFilter = 1;
						break;
					case 1:
						createTexture.minFilter = THREE.LinearFilter;
						createTexture.magFilter = THREE.LinearFilter;
						textureFilter = 2;
						break;
					case 2:
						createTexture.minFilter = THREE.LinearFilter;
						createTexture.magFilter = THREE.LinearMipMapNearestFilter;
						textureFilter = 0;
						break;
				};
				createTexture.needsUpdate = true;
			}else if (keyCode == 76) {
				if ( lightIsOn) {
					boxMesh.material = new THREE.MeshBasicMaterial({
						map:createTexture,
						side:THREE.DoubleSide
					});

					lightIsOn = false;
				}else {
					if (webGLAvaliable) {
						boxMesh.material = new THREE.MeshBasicMaterial({
							map:createTexture,
							side:THREE.DoubleSide
						});
					}
					lightIsOn = true;
				}
				boxMesh.material.needsUpdate = true;
			}else if (keyCode == 38){
				xSpeed -= 0.01;
			}else if (keyCode == 40){
				xSpeed +=0.01;
			}else if (keyCode == 37){
				ySpeed -= 0.01;
			}else if (keyCode == 39){
				ySpees += 0.01;
			}else if (keyCode == 33){
				zTranslation -= 0.2;
			}else if (keyCode == 34){
				zTranslation += 0.2;
			}

		}

		function animatedScene() {

			directionalLight.position = camera.position;

			xRotation += xSpeed;
			yRotation += ySpeed;

			boxMesh.rotation.set(xRotation, yRotation, 0.0);

			boxMesh.position.z = zTranslation;

			requestAnimationFrame(animatedScene);

			renderScene();
		}

		function renderScene() {
			renderer.render(scene, camera);
		}

	</script>

</body>
</html>